<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width">
<title>Private Chat</title>
<style>
body{margin:0;background:#020617;color:#fff;font-family:system-ui}
#app{max-width:420px;margin:auto;height:100vh;display:flex;flex-direction:column}
header{padding:12px;text-align:center;font-weight:600;border-bottom:1px solid #1e293b}
#msgs{flex:1;overflow:auto;padding:10px}
.msg{margin:6px 0;padding:8px;border-radius:8px;max-width:75%}
.me{background:#2563eb;margin-left:auto}
.other{background:#1e293b}
#bar{display:flex;gap:6px;padding:8px}
input,button{padding:10px;border-radius:6px;border:none}
input{flex:1;background:#020617;color:#fff;border:1px solid #1e293b}
button{background:#2563eb;color:#fff}
</style>
</head>

<body>
<div id="app">
<header id="title">Join Chat</header>

<div id="join">
  <input id="room" placeholder="Secret key">
  <input id="user" placeholder="Username">
  <button onclick="join()">Join</button>
</div>

<div id="chat" style="display:none">
  <div id="msgs"></div>
  <div id="bar">
    <input id="text" placeholder="Message">
    <button onclick="send()">âž¤</button>
  </div>
</div>
</div>

<script>
let ws, me;

function join(){
  const room=roomInput.value;
  me=userInput.value;
  if(!room||!me) return alert("Fill all fields");

  ws=new WebSocket(
    `wss://chat-server.skybaseofj2.workers.dev/?room=${encodeURIComponent(room)}&user=${encodeURIComponent(me)}`
  );

  ws.onopen=()=>{
    joinDiv.style.display="none";
    chat.style.display="block";
    title.innerText="Room: "+room;
  };

  ws.onmessage=e=>{
    const m=JSON.parse(e.data);
    const d=document.createElement("div");
    d.className="msg "+(m.user===me?"me":"other");
    d.innerHTML="<b>"+m.user+"</b><br>"+m.text;
    msgs.appendChild(d);
    msgs.scrollTop=msgs.scrollHeight;
  };
}

function send(){
  if(!text.value.trim()) return;
  ws.send(JSON.stringify({user:me,text:text.value}));
  text.value="";
}

const roomInput=room;
const userInput=user;
const joinDiv=join;
</script>
</body>
</html>
