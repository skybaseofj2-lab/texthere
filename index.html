<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width">
<title>Private Chat</title>

<style>
body{margin:0;background:#020617;color:#fff;font-family:system-ui}
#app{max-width:420px;margin:auto;height:100vh;display:flex;flex-direction:column}
header{padding:12px;text-align:center;font-weight:600;border-bottom:1px solid #1e293b}
#joinBox{padding:12px}
#msgs{flex:1;overflow:auto;padding:10px}
.msg{margin:6px 0;padding:8px;border-radius:8px;max-width:75%}
.me{background:#2563eb;margin-left:auto}
.other{background:#1e293b}
#bar{display:flex;gap:6px;padding:8px}
input,button{padding:10px;border-radius:6px;border:none}
input{flex:1;background:#020617;color:#fff;border:1px solid #1e293b}
button{background:#2563eb;color:#fff}
</style>
</head>

<body>
<div id="app">
  <header id="title">Join Chat</header>

  <!-- JOIN -->
  <div id="joinBox">
    <input id="room" placeholder="Secret key"> </input>
    <input id="user" placeholder="Username"> </input>
    <button id="joinBtn">Join</button>
  </div>

  <!-- CHAT -->
  <div id="chat" style="display:none">
    <div id="msgs"></div>
    <div id="bar">
      <input id="text" placeholder="Message"> </input>
      <button id="sendBtn">âž¤</button>
    </div>
  </div>
</div>

<script>
let ws;
let myName = "";

const roomInput = document.getElementById("room");
const userInput = document.getElementById("user");
const joinBox = document.getElementById("joinBox");
const chatBox = document.getElementById("chat");
const title = document.getElementById("title");
const msgs = document.getElementById("msgs");
const textInput = document.getElementById("text");

document.getElementById("joinBtn").onclick = () => {
  const room = roomInput.value.trim();
  myName = userInput.value.trim();

  if (!room || !myName) {
    alert("Enter secret key and username");
    return;
  }

  ws = new WebSocket(
    `wss://chat-server.skybaseofj2.workers.dev/?room=${encodeURIComponent(room)}&user=${encodeURIComponent(myName)}`
  );

  ws.onopen = () => {
    joinBox.style.display = "none";
    chatBox.style.display = "flex";
    title.innerText = "Room: " + room;
  };

  ws.onmessage = e => {
    const m = JSON.parse(e.data);
    const d = document.createElement("div");
    d.className = "msg " + (m.user === myName ? "me" : "other");
    d.innerHTML = `<b>${m.user}</b><br>${m.text}`;
    msgs.appendChild(d);
    msgs.scrollTop = msgs.scrollHeight;
  };

  ws.onerror = () => {
    alert("WebSocket connection failed");
  };
};

document.getElementById("sendBtn").onclick = () => {
  const t = textInput.value.trim();
  if (!t) return;
  ws.send(JSON.stringify({ user: myName, text: t }));
  textInput.value = "";
};
</script>
</body>
</html>
